FROM python:3.12-slim

# Set environment variables
ENV PYTHONUNBUFFERED=1 \
    DEBIAN_FRONTEND=noninteractive

# Set working directory
WORKDIR /app

# Copy only requirements first (we'll generate from pyproject.toml)
COPY pyproject.toml ./

# Install dependencies using pip directly from pyproject.toml
# Extract dependencies and install them
RUN pip install --no-cache-dir \
    python-dotenv \
    streamlit \
    openai \
    pymongo \
    pymilvus \
    psycopg2-binary \
    azure-storage-blob \
    gradio \
    python-liquid \
    langgraph \
    langchain-openai \
    deepeval \
    markdown \
    redis \
    weasyprint \
    html2docx \
    pypandoc \
    pdf2docx

# Copy application code
COPY . .

# Expose Streamlit port
EXPOSE 8501

# Run Streamlit
CMD ["streamlit", "run", "Home.py", "--server.port=8501", "--server.address=0.0.0.0"]
